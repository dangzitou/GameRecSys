<!DOCTYPE html>
<html class="no-js" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!--<base href="/">-->
    <base href="."/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Category | Sparrow RecSys</title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="theme-color" content="#ffffff"/>
    <link type="text/plain" rel="author"/>
    <link href="./css/style.css" rel="stylesheet"/>
    <link rel="shortcut icon" href="./resources/favicon.ico">
    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/recsys.js"></script>
    <style>
        .movie-row .movie-row-bounds .movie-row-item{
            display: block;
        }

        .movie-card-md1{
            margin:0 5px 15px 0
        }
    </style>
</head>
<body id="root">
<div>
    <header class="base-compact-header">
        <div class="ml4-container base-header-primary-container">
            <div class="base-header-logo-container">
                <span class="base-header-logo-main">
                    <a href="."><img alt="Game RecSys Logo" height="70px" src="./images/GameRecSysLogo.png"/></a>
                </span>
            </div>
            <div class="base-header-search-container">
                <form class="form-inline ng-pristine ng-valid ng-touched" novalidate="" role="form" onsubmit="event.preventDefault(); searchGame();">
                    <div class="input-group base-header-search-box">
               <span class="twitter-typeahead" style="position: relative; display: inline-block;">
                   <input class="form-control no-glow tt-input ng-pristine ng-valid ng-touched"
                          id="omnisearch-typeahead" name="currentVal" type="text" spellcheck="false" dir="auto"
                          aria-owns="omnisearch-typeahead_listbox" role="combobox"
                          aria-readonly="true" aria-autocomplete="list"
                          placeholder="Search games..."
                          style="position: relative; vertical-align: top; background-color: transparent;"/>
                </span>
                        <span class="input-group-btn">
                            <button class="btn btn-default no-glow" onclick="searchGame()">
                                <i class="fa fa-search"></i>
                            </button>
                        </span>
                    </div>
                </form>
            </div>
            <!-- Auth Section -->
            <div class="header-auth-container">
                <!-- Guest Buttons -->
                <div class="guest-auth-buttons" id="guestAuthButtons">
                    <button class="header-auth-btn btn-login" onclick="openAuthModal('login')">登录</button>
                    <button class="header-auth-btn" onclick="openAuthModal('register')">注册</button>
                </div>
                <!-- User Menu (shown when logged in) -->
                <div class="user-menu-container" id="userMenuContainer">
                    <div class="user-menu-trigger" onclick="toggleUserDropdown()">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span class="user-name" id="userName">用户</span>
                        <span style="font-size: 10px;">▼</span>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="./user.html" class="user-dropdown-item">个人中心</a>
                        <div class="user-dropdown-divider"></div>
                        <button class="user-dropdown-item" onclick="handleLogout()">退出登录</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Auth Modal -->
    <div class="auth-modal-overlay" id="authModalOverlay" onclick="closeAuthModalOnOverlay(event)">
        <div class="auth-modal">
            <div class="auth-modal-header">
                <h3 class="auth-modal-title" id="authModalTitle">登录</h3>
                <button class="auth-modal-close" onclick="closeAuthModal()">&times;</button>
            </div>
            <div class="auth-modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" id="loginTab" onclick="switchAuthTab('login')">登录</button>
                    <button class="auth-tab" id="registerTab" onclick="switchAuthTab('register')">注册</button>
                </div>

                <div class="auth-message" id="authMessage"></div>

                <!-- Login Form -->
                <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                    <div class="auth-form-group">
                        <label class="auth-form-label">用户名</label>
                        <input type="text" class="auth-form-input" id="loginUsername" placeholder="请输入用户名" required>
                    </div>
                    <div class="auth-form-group">
                        <label class="auth-form-label">密码</label>
                        <input type="password" class="auth-form-input" id="loginPassword" placeholder="请输入密码" required>
                    </div>
                    <button type="submit" class="auth-submit-btn" id="loginSubmitBtn">登录</button>
                </form>

                <!-- Register Form -->
                <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
                    <div class="auth-form-group">
                        <label class="auth-form-label">用户名</label>
                        <input type="text" class="auth-form-input" id="registerUsername" placeholder="请输入用户名" required>
                    </div>
                    <div class="auth-form-group">
                        <label class="auth-form-label">邮箱</label>
                        <input type="email" class="auth-form-input" id="registerEmail" placeholder="请输入邮箱（可选）">
                    </div>
                    <div class="auth-form-group">
                        <label class="auth-form-label">昵称</label>
                        <input type="text" class="auth-form-input" id="registerNickname" placeholder="请输入昵称（可选）">
                    </div>
                    <div class="auth-form-group">
                        <label class="auth-form-label">密码</label>
                        <input type="password" class="auth-form-input" id="registerPassword" placeholder="请输入密码（至少6位）" required minlength="6">
                    </div>
                    <div class="auth-form-group">
                        <label class="auth-form-label">确认密码</label>
                        <input type="password" class="auth-form-input" id="registerConfirmPassword" placeholder="请再次输入密码" required>
                    </div>
                    <button type="submit" class="auth-submit-btn" id="registerSubmitBtn">注册</button>
                </form>
            </div>
        </div>
    </div>
    <div class="base-compact-header-spacer"></div>
    <div class="ml4-container" style="min-height: 920px;">
        <div id="main-container">
            <div class="frontpage" id="recPage">

            </div>
        </div>
    </div>

</div>
</body>

<script type="text/javascript">
function getQueryString(name, windowLocation) {
    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
    var r = windowLocation.search.substr(1).match(reg);
    if (r != null) {
        return unescape(r[2]);
    }
    return null;
};


var windowLocation = window.location;
var type = getQueryString("type",windowLocation);
var value = getQueryString("value",windowLocation);
var page = getQueryString("page", windowLocation);
var pageNum = page ? parseInt(page) : 1;

var baseUrl = windowLocation.protocol + "//" + windowLocation.host + "/"
if(type == "genre"){
    addGenrePage('#recPage', value, value.toLowerCase() + '-collection', pageNum, 100, baseUrl);
} else if (type == "search") {
    // Implement search results display
    var rowName = "Search Results: " + value;
    var rowId = "search-collection";
    addRowFrameWithoutLink('#recPage', rowName, rowId, baseUrl);
    $.getJSON(baseUrl + "search?query=" + encodeURIComponent(value) + "&size=100", function(result){
        $.each(result, function(i, game){
          appendGame2Row(rowId, game, baseUrl);
        });
    });
}

</script>
</html>